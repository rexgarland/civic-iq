<head>
  <link
    href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:400,700"
    rel="stylesheet"
  />
  <link href="style.css" rel="stylesheet" type="text/css" />
  <title>Civic IQ Results</title>
  <link rel="icon" type="x-icon" href="icon.png" />
  <link rel="shortcut icon" type="x-icon" href="icon.png" />
  <meta charset="utf-8" />
</head>

<body>
  <h1>Civic IQ</h1>
  <hr />

  <h1>Results</h1>
  <h2 id="score"></h2>
  <hr />
  <img src="" id="banner" />
  <button class="button" onclick="location.href='index.html';">Back</button>
  <br />

  <script type="application/javascript" src="questions.js"></script>
  <script>
    function problem(msg) {
      alert(`Error: ${msg}\nPlease contact maintainers to fix.`);
    }

    function getAnswersFromWindowURL() {
      var url = new URL(window.location);
      const data = url.searchParams.get("data");
      if (data === null) {
        problem("Could not find quiz answers within URL.");
        return;
      }

      try {
        return JSON.parse(atob(data));
      } catch {
        problem("Could not parse quiz answers.");
      }
    }

    const answers = getAnswersFromWindowURL();

    const total = questions.length;
    if (!answers) {
      problem("Could not find all answers for calculating quiz results.");
    }
    if (answers.length !== total) {
      problem(`${answers.length} answers found for quiz of length ${total}.`);
    }

    let score = 0;
    for (let i = 0; i < questions.length; i++) {
      const question = questions[i];
      const correctAnswer = question.answer;

      const chosenIndex = answers[i];
      const chosenOption = question.options[chosenIndex];

      if (chosenOption === correctAnswer) {
        score++;
      }
    }

    document.getElementById(
      "score"
    ).innerHTML = `You got ${score}/${total} (${Math.round(
      (score / total) * 100
    )}%) correct!`;
  </script>
</body>
